// Copyright Â© 2025 Daydream2740. All Rights Reserved.
// Game state
let gameState = {
  player: null,
  players: [], // For leaderboard
  jobOffers: [
    {
      title: "Office Worker",
      basePay: 50,
      description: "A steady 9-5 job with decent pay",
      statBoosts: { intelligence: 2, organization: 1, timeManagement: 1 },
      requirements: { intelligence: 2 }
    },
    {
      title: "Construction Worker",
      basePay: 45,
      description: "Physical labor with slightly lower pay but better strength gains",
      statBoosts: { strength: 2, manualLabor: 2, defense: 1 },
      requirements: { strength: 2 }
    },
    {
      title: "Freelancer",
      basePay: 40,
      description: "Flexible hours but less stable pay, good for dexterity",
      statBoosts: { dexterity: 2, intelligence: 1, timeManagement: 1 },
      requirements: { dexterity: 2 }
    }
  ],
  consumables: [
    { name: "Coffee", price: 100, happinessBoost: 5, duration: 5 },
    { name: "Fast Food Meal", price: 150, happinessBoost: 10, duration: 10 },
    { name: "Movie Ticket", price: 200, happinessBoost: 15, duration: 15 },
    { name: "Video Game", price: 600, happinessBoost: 20, duration: 30 },
    { name: "New Outfit", price: 800, happinessBoost: 25, duration: 40 },
    { name: "Dinner Date", price: 1000, happinessBoost: 30, duration: 45 },
    { name: "Smartphone", price: 1200, happinessBoost: 35, duration: 50 },
    { name: "Weekend Getaway", price: 1500, happinessBoost: 40, duration: 60 },
    { name: "Concert Tickets", price: 1800, happinessBoost: 45, duration: 65 },
    { name: "Gaming Console", price: 2000, happinessBoost: 50, duration: 70 },
    { name: "Smart TV", price: 2500, happinessBoost: 55, duration: 75 },
    { name: "Laptop", price: 3000, happinessBoost: 60, duration: 80 },
    { name: "Home Theater System", price: 3500, happinessBoost: 65, duration: 85 },
    { name: "Luxury Watch", price: 4000, happinessBoost: 70, duration: 90 },
    { name: "Dream Vacation", price: 5000, happinessBoost: 75, duration: 95 },
    { name: "High-end Computer", price: 6000, happinessBoost: 80, duration: 100 },
    { name: "Jewelry", price: 7000, happinessBoost: 85, duration: 105 },
    { name: "Designer Furniture Set", price: 8000, happinessBoost: 90, duration: 110 },
    { name: "Original Artwork", price: 9000, happinessBoost: 95, duration: 115 },
    { name: "Rare Collectible", price: 10000, happinessBoost: 100, duration: 120 }
  ],
  houses: [
    { name: "Small Studio Apartment", price: 10000, happinessBoost: 20, permanentHappiness: 5 },
    { name: "One Bedroom Apartment", price: 50000, happinessBoost: 30, permanentHappiness: 10 },
    { name: "Two Bedroom Apartment", price: 100000, happinessBoost: 40, permanentHappiness: 15 },
    { name: "Small House", price: 250000, happinessBoost: 60, permanentHappiness: 20 },
    { name: "Suburban Home", price: 500000, happinessBoost: 80, permanentHappiness: 25 },
    { name: "Luxury Condo", price: 1000000, happinessBoost: 100, permanentHappiness: 30 },
    { name: "Beach House", price: 2500000, happinessBoost: 150, permanentHappiness: 40 },
    { name: "Mansion", price: 5000000, happinessBoost: 200, permanentHappiness: 50 },
    { name: "Private Island Estate", price: 7500000, happinessBoost: 250, permanentHappiness: 60 },
    { name: "Luxury Castle", price: 10000000, happinessBoost: 300, permanentHappiness: 75 }
  ],
  activeEffects: [],
  workCounter: 0,
  isAdmin: false,
  adminCode: "Mr.Bee2740"
};

// Utility functions
function getXpForLevel(level) {
  if (level === 1) return 0;
  return 1000 + (level - 1) * 1500;
}

function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function saveGame() {
  localStorage.setItem('rpgGameSave', JSON.stringify(gameState));
  displayMessage("Game saved successfully!");
}

function loadGame() {
  const savedGame = localStorage.getItem('rpgGameSave');
  if (savedGame) {
    gameState = JSON.parse(savedGame);
    updateUI();
    displayMessage("Game loaded successfully!");
    return true;
  }
  return false;
}

function displayMessage(message) {
  const messageArea = document.getElementById('message-area');
  const messageElement = document.createElement('div');
  messageElement.textContent = message;
  messageElement.classList.add('game-message');
  messageArea.appendChild(messageElement);
  
  // Auto-remove message after 5 seconds
  setTimeout(() => {
    messageElement.remove();
  }, 5000);
}

// Player creation function
function createPlayer(name) {
  return {
    name: name,
    money: 500,
    job: null,
    level: 1,
    xp: 0,
    happiness: 100,
    baseHappiness: 100,
    stats: {
      strength: 1,
      dexterity: 1,
      speed: 1,
      defense: 1
    },
    jobStats: {
      manualLabor: 1,
      intelligence: 1,
      timeManagement: 1,
      organization: 1
    },
    statPoints: 4,
    jobPoints: 0,
    workCooldown: false,
    timesWorked: 0,
    itemsOwned: [],
    house: null
  };
}

// Initialize the game when the window loads
window.onload = function() {
  // Try to load saved game
  if (!loadGame()) {
    showPlayerCreation();
  }
};

function showPlayerCreation() {
  const gameContainer = document.getElementById('game-container');
  gameContainer.innerHTML = `
    <div class="creation-screen">
      <h1>Create Your Character</h1>
      <div class="input-group">
        <label for="player-name">Your Name:</label>
        <input type="text" id="player-name" placeholder="Enter your name">
      </div>
      
      <h2>Assign Stat Points (4 Available)</h2>
      <div class="stats-container">
        <div class="stat-group">
          <label for="strength">Strength: 1</label>
          <button onclick="adjustStat('strength', 1)">+</button>
          <button onclick="adjustStat('strength', -1)">-</button>
        </div>
        <div class="stat-group">
          <label for="dexterity">Dexterity: 1</label>
          <button onclick="adjustStat('dexterity', 1)">+</button>
          <button onclick="adjustStat('dexterity', -1)">-</button>
        </div>
        <div class="stat-group">
          <label for="speed">Speed: 1</label>
          <button onclick="adjustStat('speed', 1)">+</button>
          <button onclick="adjustStat('speed', -1)">-</button>
        </div>
        <div class="stat-group">
          <label for="defense">Defense: 1</label>
          <button onclick="adjustStat('defense', 1)">+</button>
          <button onclick="adjustStat('defense', -1)">-</button>
        </div>
      </div>
      
      <div class="points-remaining">Stat Points Remaining: <span id="points-remaining">4</span></div>
      
      <button id="create-character" onclick="finishCharacterCreation()">Create Character</button>
    </div>
  `;
}

// Temporary stat values during character creation
let tempStats = {
  strength: 1,
  dexterity: 1,
  speed: 1,
  defense: 1
};
let statPointsRemaining = 4;

function adjustStat(stat, amount) {
  if (amount > 0 && statPointsRemaining <= 0) return;
  if (amount < 0 && tempStats[stat] <= 1) return;
  
  tempStats[stat] += amount;
  statPointsRemaining -= amount;
  
  document.querySelector(`.stat-group label[for="${stat}"]`).textContent = `${stat.charAt(0).toUpperCase() + stat.slice(1)}: ${tempStats[stat]}`;
  document.getElementById('points-remaining').textContent = statPointsRemaining;
}

function finishCharacterCreation() {
  const playerName = document.getElementById('player-name').value;
  if (!playerName) {
    displayMessage("Please enter a name!");
    return;
  }
  
  gameState.player = createPlayer(playerName);
  gameState.player.stats = Object.assign({}, tempStats);
  gameState.player.statPoints = statPointsRemaining;
  
  // Add to leaderboard
  gameState.players.push({
    name: playerName,
    money: gameState.player.money,
    level: gameState.player.level
  });
  
  showJobSelection();
}

function showJobSelection() {
  const gameContainer = document.getElementById('game-container');
  
  let jobsHTML = '';
  gameState.jobOffers.forEach((job, index) => {
    const canTakeJob = gameState.player.stats[Object.keys(job.requirements)[0]] >= job.requirements[Object.keys(job.requirements)[0]];
    
    jobsHTML += `
      <div class="job-card ${canTakeJob ? '' : 'job-locked'}">
        <h3>${job.title}</h3>
        <p>${job.description}</p>
        <p>Pay: $${job.basePay} per work shift</p>
        <h4>Stat Boosts:</h4>
        <ul>
          ${Object.entries(job.statBoosts).map(([stat, boost]) => `<li>${stat.charAt(0).toUpperCase() + stat.slice(1)}: +${boost}</li>`).join('')}
        </ul>
        <p class="job-req">Requires: ${Object.keys(job.requirements)[0].charAt(0).toUpperCase() + Object.keys(job.requirements)[0].slice(1)} ${job.requirements[Object.keys(job.requirements)[0]]}</p>
        ${canTakeJob ? `<button onclick="selectJob(${index})">Take this job</button>` : '<p class="job-locked-text">Requirements not met</p>'}
      </div>
    `;
  });
  
  gameContainer.innerHTML = `
    <div class="job-selection-screen">
      <h1>Choose Your Job</h1>
      <div class="jobs-container">
        ${jobsHTML}
      </div>
    </div>
  `;
}

function selectJob(jobIndex) {
  gameState.player.job = gameState.jobOffers[jobIndex];
  initializeMainGame();
}

function initializeMainGame() {
  const gameContainer = document.getElementById('game-container');
  
  gameContainer.innerHTML = `
    <div class="main-game">
      <div class="header">
        <h1>RPG Life Simulator</h1>
        <div class="player-info">
          <span id="player-name">${gameState.player.name}</span>
          <span id="player-level">Level: ${gameState.player.level}</span>
          <span id="player-money">Money: $${gameState.player.money.toFixed(2)}</span>
          <span id="player-happiness">Happiness: ${gameState.player.happiness}%</span>
          <div class="xp-bar-container">
            <div id="xp-bar" style="width: ${(gameState.player.xp / getXpForLevel(gameState.player.level + 1)) * 100}%"></div>
            <span id="xp-text">${gameState.player.xp} / ${getXpForLevel(gameState.player.level + 1)} XP</span>
          </div>
        </div>
      </div>
      
      <div class="game-content">
        <div class="left-panel">
          <div class="job-info">
            <h2>Current Job: ${gameState.player.job.title}</h2>
            <p>Base Pay: $${gameState.player.job.basePay}</p>
            <button id="work-button" onclick="work()">Work</button>
            <div id="cooldown-timer"></div>
          </div>
          
          <div class="main-buttons">
            <button onclick="toggleStatsPanel()">View Stats</button>
            <button onclick="toggleShopPanel()">Shop</button>
            <button onclick="toggleHousingPanel()">Housing</button>
            <button onclick="toggleLeaderboard()">Leaderboard</button>
            <button onclick="saveGame()">Save Game</button>
            <button onclick="showAdminPanel()">Admin Panel</button>
          </div>
        </div>
        
        <div class="right-panel" id="stats-panel">
          <h2>Player Stats</h2>
          <div class="stats-list">
            <h3>Base Stats:</h3>
            <p>Strength: ${gameState.player.stats.strength}</p>
            <p>Dexterity: ${gameState.player.stats.dexterity}</p>
            <p>Speed: ${gameState.player.stats.speed}</p>
            <p>Defense: ${gameState.player.stats.defense}</p>
            <p>Happiness: ${gameState.player.happiness}%</p>
            
            <h3>Job Stats:</h3>
            <p>Manual Labor: ${gameState.player.jobStats.manualLabor}</p>
            <p>Intelligence: ${gameState.player.jobStats.intelligence}</p>
            <p>Time Management: ${gameState.player.jobStats.timeManagement}</p>
            <p>Organization: ${gameState.player.jobStats.organization}</p>
            
            <div class="point-allocation">
              <h3>Stat Points: <span id="stat-points">${gameState.player.statPoints}</span></h3>
              <div class="stat-buttons">
                <button onclick="improveBaseStat('strength')">Improve Strength</button>
                <button onclick="improveBaseStat('dexterity')">Improve Dexterity</button>
                <button onclick="improveBaseStat('speed')">Improve Speed</button>
                <button onclick="improveBaseStat('defense')">Improve Defense</button>
              </div>
              
              <h3>Job Points: <span id="job-points">${gameState.player.jobPoints}</span></h3>
              <div class="job-stat-buttons">
                <button onclick="improveJobStat('manualLabor')">Improve Manual Labor</button>
                <button onclick="improveJobStat('intelligence')">Improve Intelligence</button>
                <button onclick="improveJobStat('timeManagement')">Improve Time Management</button>
                <button onclick="improveJobStat('organization')">Improve Organization</button>
              </div>
            </div>
          </div>
          <button onclick="hidePanel()">Close</button>
        </div>
        
        <div class="right-panel" id="shop-panel" style="display: none;">
          <h2>Shop</h2>
          <div class="shop-items">
            <h3>Consumables</h3>
            <div class="items-grid" id="consumables-list">
              ${gameState.consumables.map(item => `
                <div class="shop-item">
                  <h4>${item.name}</h4>
                  <p>Price: $${item.price}</p>
                  <p>Happiness: +${item.happinessBoost}%</p>
                  <p>Duration: ${item.duration} actions</p>
                  <button onclick="buyConsumable(${gameState.consumables.indexOf(item)})">Buy</button>
                </div>
              `).join('')}
            </div>
          </div>
          <button onclick="hidePanel()">Close</button>
        </div>
        
        <div class="right-panel" id="housing-panel" style="display: none;">
          <h2>Housing</h2>
          <div class="housing-items">
            <h3>Available Properties</h3>
            <div class="items-grid" id="housing-list">
              ${gameState.houses.map(house => `
                <div class="shop-item">
                  <h4>${house.name}</h4>
                  <p>Price: $${house.price.toLocaleString()}</p>
                  <p>Initial Happiness: +${house.happinessBoost}%</p>
                  <p>Permanent Happiness: +${house.permanentHappiness}%</p>
                  <button onclick="buyHouse(${gameState.houses.indexOf(house)})" ${gameState.player.money < house.price ? 'disabled' : ''}>Buy</button>
                </div>
              `).join('')}
            </div>
          </div>
          <button onclick="hidePanel()">Close</button>
        </div>
        
        <div class="right-panel" id="leaderboard-panel" style="display: none;">
          <h2>Leaderboard</h2>
          <table class="leaderboard-table">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Name</th>
                <th>Level</th>
                <th>Money</th>
              </tr>
            </thead>
            <tbody id="leaderboard-body">
              ${generateLeaderboardRows()}
            </tbody>
          </table>
          <button onclick="hidePanel()">Close</button>
        </div>
        
        <div class="right-panel" id="admin-panel" style="display: none;">
          <h2>Admin Panel</h2>
          <div class="admin-login" id="admin-login-form">
            <label for="admin-code">Enter Admin Code:</label>
            <input type="password" id="admin-code">
            <button onclick="verifyAdmin()">Login</button>
          </div>
          
          <div class="admin-controls" id="admin-controls" style="display: none;">
            <h3>Player Management</h3>
            <div class="player-list" id="admin-player-list">
              ${gameState.players.map(player => `
                <div class="admin-player-item">
                  <span>${player.name}</span>
                  <button onclick="deletePlayer('${player.name}')">Delete</button>
                  <button onclick="showRenamePlayer('${player.name}')">Rename</button>
                </div>
              `).join('')}
            </div>
          </div>
          <button onclick="hidePanel()">Close</button>
        </div>
      </div>
      
      <div id="message-area" class="message-area"></div>
    </div>
  `;
  
  // Add CSS to the head
  const style = document.createElement('style');
  style.innerHTML = `
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f0f0f0;
      color: #333;
    }
    
    #game-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .creation-screen, .job-selection-screen {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    h1, h2, h3 {
      margin-bottom: 15px;
      color: #444;
    }
    
    .input-group {
      margin-bottom: 20px;
    }
    
    input {
      padding: 8px;
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    button:hover {
      background-color: #45a049;
    }
    
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-group {
      display: flex;
      align-items: center;
    }
    
    .stat-group label {
      flex: 1;
    }
    
    .stat-group button {
      margin-left: 5px;
    }
    
    .points-remaining {
      margin-bottom: 20px;
      font-weight: bold;
    }
    
    .jobs-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .job-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      background-color: white;
      transition: transform 0.3s;
    }
    
    .job-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .job-locked {
      opacity: 0.7;
      background-color: #f9f9f9;
    }
    
    .job-locked-text {
      color: #d9534f;
      font-weight: bold;
    }
    
    .job-req {
      font-style: italic;
      margin: 10px 0;
    }
    
    .main-game {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .header {
      background-color: #4CAF50;
      color: white;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .player-info {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
    }
    
    .xp-bar-container {
      width: 200px;
      height: 20px;
      background-color: #eee;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }
    
    #xp-bar {
      height: 100%;
      background-color: #ffc107;
      transition: width 0.3s;
    }
    
    #xp-text {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }
    
    .game-content {
      display: flex;
      padding: 20px;
    }
    
    .left-panel {
      flex: 1;
      margin-right: 20px;
    }
    
    .job-info {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    #work-button {
      background-color: #007bff;
      width: 100%;
      padding: 15px;
      font-size: 18px;
      margin-top: 10px;
    }
    
    #work-button:hover {
      background-color: #0069d9;
    }
    
    #cooldown-timer {
      text-align: center;
      margin-top: 10px;
      font-weight: bold;
      color: #dc3545;
    }
    
    .main-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .right-panel {
      flex: 2;
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 20px;
      overflow-y: auto;
      max-height: 600px;
    }
    
    .stats-list {
      margin-bottom: 20px;
    }
    
    .stats-list h3 {
      margin-top: 15px;
      margin-bottom: 10px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }
    
    .point-allocation {
      margin-top: 20px;
      border-top: 1px solid #ddd;
      padding-top: 20px;
    }
    
    .stat-buttons, .job-stat-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .shop-item {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      background-color: white;
    }
    
    .shop-item button {
      width: 100%;
      margin-top: 10px;
    }
    
    .leaderboard-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .leaderboard-table th, .leaderboard-table td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    
    .leaderboard-table th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    
    .message-area {
      position: fixed;
      bottom: 20px;
      right: 20px;
      max-width: 300px;
    }
    
    .game-message {
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      margin-top: 10px;
      animation: fadeInOut 5s forwards;
    }
    
    @keyframes fadeInOut {
      0% { opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { opacity: 0; }
    }
    
    .admin-player-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    
    .admin-player-item button {
      margin-left: 5px;
    }
  `;
  document.head.appendChild(style);
}

// Game mechanics functions
function toggleStatsPanel() {
  hideAllPanels();
  document.getElementById('stats-panel').style.display = 'block';
  updateUI();
}

function toggleShopPanel() {
  hideAllPanels();
  document.getElementById('shop-panel').style.display = 'block';
}

function toggleHousingPanel() {
  hideAllPanels();
  document.getElementById('housing-panel').style.display = 'block';
}

function toggleLeaderboard() {
  hideAllPanels();
  document.getElementById('leaderboard-panel').style.display = 'block';
  document.getElementById('leaderboard-body').innerHTML = generateLeaderboardRows();
}

function hideAllPanels() {
  document.getElementById('stats-panel').style.display = 'none';
  document.getElementById('shop-panel').style.display = 'none';
  document.getElementById('housing-panel').style.display = 'none';
  document.getElementById('leaderboard-panel').style.display = 'none';
  document.getElementById('admin-panel').style.display = 'none';
}

function hidePanel() {
  hideAllPanels();
}

function improveBaseStat(stat) {
  if (gameState.player.statPoints <= 0) {
    displayMessage("You don't have any stat points!");
    return;
  }
  
  gameState.player.stats[stat]++;
  gameState.player.statPoints--;
  
  // Decrease happiness by a small amount
  decreaseHappiness(2);
  
  updateUI();
  displayMessage(`Improved ${stat} to ${gameState.player.stats[stat]}!`);
}

function improveJobStat(stat) {
  if (gameState.player.jobPoints <= 0) {
    displayMessage("You don't have any job points!");
    return;
  }
  
  gameState.player.jobStats[stat]++;
  gameState
